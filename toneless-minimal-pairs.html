<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toneless Pinyin Minimal Pairs Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .quiz-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 100%;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 14px;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 14px;
            color: #1976d2;
        }

        .audio-section {
            text-align: center;
            margin: 30px 0;
        }

        .play-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .play-button:hover {
            background: #0056b3;
            transform: scale(1.05);
        }

        .play-button:active {
            transform: scale(0.95);
        }

        .play-button.playing {
            background: #28a745;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .option-btn {
            padding: 25px;
            font-size: 28px;
            font-weight: 500;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }

        .option-btn.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .option-btn.selected {
            border-color: #007bff;
            border-width: 3px;
            background: #e3f2fd;
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            min-height: 30px;
        }

        .feedback.correct {
            color: #28a745;
        }

        .feedback.incorrect {
            color: #dc3545;
        }

        .stats {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stats-text {
            font-size: 16px;
            color: #666;
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .home-btn:hover {
            background: #0056b3;
        }

        .keyboard-hint {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <a href="home.html" class="home-btn">üè† Home</a>
    <div class="quiz-container">
        <h1>Toneless Pinyin Practice</h1>
        <div class="subtitle">Êó†Â£∞Ë∞ÉÊãºÈü≥ÊúÄÂ∞èÂØπÊØîÁªÉ‰π† | Minimal Pairs (without tones)</div>

        <div class="info-box">
            üìù <strong>Test Format:</strong> In your oral test, you'll read pinyin minimal pairs <strong>without tone marks</strong>.
            This tests your ability to distinguish similar sounds like <em>da/ta</em>, <em>ni/li</em>, <em>shi/xi</em>, etc.
        </div>

        <div class="audio-section">
            <button class="play-button" id="playBtn">üîä Play Audio</button>
        </div>

        <div style="text-align: center; font-size: 16px; margin-bottom: 20px; color: #666;">
            Which pinyin did you hear?
        </div>

        <div class="options" id="options"></div>

        <div class="feedback" id="feedback"></div>

        <div class="keyboard-hint">
            ‚å®Ô∏è Use <kbd>h</kbd>/<kbd>l</kbd> to select, <kbd>Enter</kbd> to confirm, <kbd>Space</kbd> to replay
        </div>

        <div class="stats">
            <div class="stats-text">
                Score: <strong id="score">0</strong> / <strong id="total">0</strong>
                (<span id="percentage">0</span>%)
            </div>
        </div>
    </div>

    <script>
        // Minimal pairs from the test review slides
        const minimalPairs = [
            // From slide: da-ta, ni-li, shi-xi, zi-qi
            ['da', 'ta'],
            ['ni', 'li'],
            ['shi', 'xi'],
            ['zi', 'qi'],

            // From slide: ca-qia, lai-lei, tui-dui, nong-long
            ['ca', 'qia'],
            ['lai', 'lei'],
            ['tui', 'dui'],
            ['nong', 'long'],

            // From slide: ke-he, sun-xun, chuan-quan, xian-qian
            ['ke', 'he'],
            ['sun', 'xun'],
            ['chuan', 'quan'],
            ['xian', 'qian'],

            // From slide: zhen-zeng, shang-xiang
            ['zhen', 'zeng'],
            ['shang', 'xiang'],

            // Additional common minimal pairs for practice
            ['bing', 'ping'],
            ['ming', 'ding'],
            ['jin', 'qin'],
            ['zhang', 'chang'],
            ['zhi', 'chi'],
            ['si', 'shi'],
            ['ci', 'qi'],
            ['zi', 'ci'],
            ['ju', 'qu'],
            ['xu', 'shu'],
            ['ran', 'lan'],
            ['ren', 'len'],
            ['rao', 'lao'],
            ['zou', 'zhou'],
            ['zao', 'zhao'],
            ['cai', 'chai'],
            ['sai', 'shai'],
            ['gan', 'kan'],
            ['dang', 'tang'],
            ['bian', 'pian'],
            ['jiao', 'qiao'],
            ['xiao', 'shao']
        ];

        let currentPair = [];
        let currentCorrect = '';
        let currentTone = 1;
        let score = 0;
        let total = 0;
        let answered = false;
        let selectedOptionIndex = 0;

        const playBtn = document.getElementById('playBtn');
        const feedback = document.getElementById('feedback');

        function generateQuestion() {
            // Pick a random minimal pair
            currentPair = minimalPairs[Math.floor(Math.random() * minimalPairs.length)];

            // Pick one as the correct answer
            currentCorrect = currentPair[Math.floor(Math.random() * 2)];

            // Random tone (1-4)
            currentTone = Math.floor(Math.random() * 4) + 1;

            answered = false;
            feedback.textContent = '';
            feedback.className = 'feedback';

            generateOptions();
        }

        function generateOptions() {
            const options = document.getElementById('options');
            options.innerHTML = '';

            // Show both pinyin as text options (without tones)
            currentPair.forEach((pinyin, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = pinyin;
                btn.dataset.pinyin = pinyin;
                btn.dataset.index = index;
                btn.onclick = () => checkAnswer(pinyin, btn);
                options.appendChild(btn);
            });

            // Reset and select first option
            selectedOptionIndex = 0;
            updateSelectedOption();
        }

        function updateSelectedOption() {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, idx) => {
                if (idx === selectedOptionIndex) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
        }

        function selectOption(index) {
            const buttons = document.querySelectorAll('.option-btn');
            if (index >= 0 && index < buttons.length) {
                selectedOptionIndex = index;
                updateSelectedOption();
            }
        }

        function activateSelectedOption() {
            const buttons = document.querySelectorAll('.option-btn');
            if (selectedOptionIndex >= 0 && selectedOptionIndex < buttons.length) {
                buttons[selectedOptionIndex].click();
            }
        }

        function playAudio() {
            playBtn.classList.add('playing');
            const audioUrl = `https://www.purpleculture.net/mp3/${currentCorrect}${currentTone}.mp3`;
            const audio = new Audio(audioUrl);

            audio.play().catch(err => {
                console.error('Audio playback failed:', err);
                playBtn.classList.remove('playing');
            });

            audio.onended = () => {
                playBtn.classList.remove('playing');
            };
        }

        function playPinyinAudio(pinyin, tone) {
            const audioUrl = `https://www.purpleculture.net/mp3/${pinyin}${tone}.mp3`;
            const audio = new Audio(audioUrl);
            audio.play().catch(err => {
                console.error('Audio playback failed:', err);
            });
        }

        function checkAnswer(pinyin, btnElement) {
            if (answered) return;

            answered = true;
            total++;

            const correct = pinyin === currentCorrect;

            if (correct) {
                score++;
                feedback.textContent = `‚úì Correct! (${currentCorrect})`;
                feedback.className = 'feedback correct';
                btnElement.classList.add('correct');

                // Auto-advance to next question
                setTimeout(() => {
                    generateQuestion();
                    playAudio();
                }, 800);
            } else {
                feedback.textContent = `‚úó Wrong. The answer was: ${currentCorrect}`;
                feedback.className = 'feedback incorrect';
                btnElement.classList.add('incorrect');

                // Show correct answer
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.dataset.pinyin === currentCorrect) {
                        btn.classList.add('correct');
                    }
                });

                // Auto-advance on wrong answer
                setTimeout(() => {
                    generateQuestion();
                    playAudio();
                }, 1200);
            }

            updateStats();

            // Disable buttons after answer
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
            });
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = total;
            const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
            document.getElementById('percentage').textContent = percentage;
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!answered) {
                if (e.key === ' ') {
                    e.preventDefault();
                    playAudio();
                } else if (e.key === 'h') {
                    e.preventDefault();
                    if (selectedOptionIndex === 1) selectOption(0);
                } else if (e.key === 'l') {
                    e.preventDefault();
                    if (selectedOptionIndex === 0) selectOption(1);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    activateSelectedOption();
                }
            }
        });

        playBtn.addEventListener('click', playAudio);

        // Start first question
        generateQuestion();
        playAudio();
    </script>
</body>
</html>
