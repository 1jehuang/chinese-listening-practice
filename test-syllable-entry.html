<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Syllable Entry</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-case {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; }
        .fail { background: #f8d7da; }
        input {
            padding: 8px;
            font-size: 16px;
            width: 200px;
            margin-right: 10px;
        }
        button {
            padding: 8px 15px;
            font-size: 16px;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>Syllable Entry Test</h1>

    <div class="test-case">
        <h3>Test Word: 中国 (Zhōng.guo)</h3>
        <p>Expected: Type "zhong1" → Enter → "guo" → Enter</p>
        <input type="text" id="testInput" placeholder="Type syllable...">
        <button onclick="checkSyllable()">Check</button>
        <button onclick="reset()">Reset</button>
        <div id="result"></div>
    </div>

    <div class="test-case">
        <h3>Automated Tests:</h3>
        <button onclick="runTests()">Run All Tests</button>
        <div id="testResults"></div>
    </div>

    <script>
        const testWord = { char: '中国', pinyin: 'Zhōng.guo', meaning: 'China' };
        let enteredSyllables = [];

        function convertPinyinToToneNumbers(pinyin) {
            const toneMap = {
                'ā': 'a1', 'á': 'a2', 'ǎ': 'a3', 'à': 'a4',
                'ē': 'e1', 'é': 'e2', 'ě': 'e3', 'è': 'e4',
                'ī': 'i1', 'í': 'i2', 'ǐ': 'i3', 'ì': 'i4',
                'ō': 'o1', 'ó': 'o2', 'ǒ': 'o3', 'ò': 'o4',
                'ū': 'u1', 'ú': 'u2', 'ǔ': 'u3', 'ù': 'u4',
                'ǖ': 'v1', 'ǘ': 'v2', 'ǚ': 'v3', 'ǜ': 'v4',
                'ü': 'v'
            };

            let result = pinyin.toLowerCase();
            for (const [marked, numbered] of Object.entries(toneMap)) {
                result = result.replace(new RegExp(marked, 'g'), numbered);
            }
            return result;
        }

        function splitPinyinSyllables(pinyin) {
            let text = pinyin.trim();

            if (text.includes(' ') || text.includes('.')) {
                return text.split(/[\s.]+/);
            }

            const withNumbers = convertPinyinToToneNumbers(text);
            const matches = withNumbers.match(/[a-zv]+[1-4]/gi);
            if (matches) {
                return matches;
            }

            return [text];
        }

        function checkSyllable() {
            const input = document.getElementById('testInput');
            const userAnswer = input.value.trim();
            const result = document.getElementById('result');

            if (!userAnswer) return;

            const syllables = splitPinyinSyllables(testWord.pinyin);
            const syllablesWithNumbers = splitPinyinSyllables(convertPinyinToToneNumbers(testWord.pinyin));

            if (enteredSyllables.length >= syllables.length) {
                result.innerHTML = '<strong style="color: red;">All syllables already entered!</strong>';
                return;
            }

            const expectedSyllable = syllables[enteredSyllables.length];
            const expectedSyllableWithNumbers = syllablesWithNumbers[enteredSyllables.length];

            const userLower = userAnswer.toLowerCase();
            const expectedLower = expectedSyllable.toLowerCase();
            const expectedNumLower = expectedSyllableWithNumbers.toLowerCase();

            if (userLower === expectedLower || userLower === expectedNumLower) {
                enteredSyllables.push(expectedSyllable);
                input.value = '';

                if (enteredSyllables.length === syllables.length) {
                    result.innerHTML = `<strong style="color: green;">✓ Complete! All syllables entered: ${enteredSyllables.join(' ')}</strong>`;
                    result.style.background = '#d4edda';
                } else {
                    const remaining = syllables.slice(enteredSyllables.length).join(' ');
                    result.innerHTML = `<strong style="color: blue;">✓ Correct! Progress: ${enteredSyllables.join(' ')} | Next: ${remaining}</strong>`;
                    result.style.background = '#d1ecf1';
                }
            } else {
                result.innerHTML = `<strong style="color: red;">✗ Wrong! Expected: "${expectedSyllable}" or "${expectedSyllableWithNumbers}"</strong>`;
                result.style.background = '#f8d7da';
            }
        }

        function reset() {
            enteredSyllables = [];
            document.getElementById('testInput').value = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('result').style.background = '';
        }

        function runTests() {
            const results = [];

            // Test 1: Split "Zhōng.guo"
            const test1 = splitPinyinSyllables('Zhōng.guo');
            results.push({
                name: 'Split "Zhōng.guo"',
                expected: '["Zhōng", "guo"]',
                actual: JSON.stringify(test1),
                pass: test1.length === 2 && test1[0] === 'Zhōng' && test1[1] === 'guo'
            });

            // Test 2: Convert to tone numbers
            const test2 = convertPinyinToToneNumbers('Zhōng.guo');
            results.push({
                name: 'Convert "Zhōng.guo" to tone numbers',
                expected: '"zhong1.guo"',
                actual: `"${test2}"`,
                pass: test2 === 'zhong1.guo'
            });

            // Test 3: Split tone numbers
            const test3 = splitPinyinSyllables('zhong1.guo');
            results.push({
                name: 'Split "zhong1.guo"',
                expected: '["zhong1", "guo"]',
                actual: JSON.stringify(test3),
                pass: test3.length === 2 && test3[0] === 'zhong1' && test3[1] === 'guo'
            });

            // Test 4: Split "zhong1guo2" (no separator)
            const test4 = splitPinyinSyllables('zhong1guo2');
            results.push({
                name: 'Split "zhong1guo2"',
                expected: '["zhong1", "guo2"]',
                actual: JSON.stringify(test4),
                pass: test4.length === 2 && test4[0] === 'zhong1' && test4[1] === 'guo2'
            });

            // Display results
            let html = '<div style="margin-top: 15px;">';
            results.forEach(r => {
                const className = r.pass ? 'success' : 'fail';
                html += `<div class="test-case ${className}">
                    <strong>${r.pass ? '✓' : '✗'} ${r.name}</strong><br>
                    Expected: ${r.expected}<br>
                    Actual: ${r.actual}
                </div>`;
            });
            html += '</div>';
            document.getElementById('testResults').innerHTML = html;
        }

        // Allow Enter key
        document.getElementById('testInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkSyllable();
            }
        });
    </script>
</body>
</html>
