<!DOCTYPE html>
<html lang="zh-CN" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>Test 2 - Dialogue Completion Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/common.css">
    <script src="js/utils.js"></script>
    <script src="js/command-palette.js"></script>
    <script src="js/pinyin-utils.js"></script>
    <script src="js/engine/ai-service.js"></script>
    <script src="js/engine/chat.js"></script>
    <script src="js/quiz-engine.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-sync.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">
    <a href="test2-practice.html" class="fixed top-4 left-4 bg-white hover:bg-gray-100 text-gray-700 px-3 py-2 rounded-lg shadow border border-gray-200 transition text-sm">â† Back to Test 2</a>

    <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8 mt-16 md:mt-0">
        <h1 class="text-3xl font-bold text-center mb-2 text-gray-800">Dialogue Completion Practice</h1>
        <p class="text-center text-gray-600 mb-6">Written Test 2 - Section 2</p>

        <!-- Mode Selector -->
        <div class="flex flex-wrap gap-2 justify-center mb-6">
            <button class="mode-btn px-4 py-2 rounded-lg border-2 border-gray-300 hover:bg-gray-100 transition active:bg-blue-500 active:text-white active:border-blue-500" data-mode="meaning-to-char">Complete Dialogue</button>
            <button class="mode-btn px-4 py-2 rounded-lg border-2 border-gray-300 hover:bg-gray-100 transition" data-mode="char-to-meaning-type">Identify Pattern</button>
            <button class="mode-btn px-4 py-2 rounded-lg border-2 border-gray-300 hover:bg-gray-100 transition" data-mode="audio-to-meaning">Audio â†’ Meaning</button>
            <button class="mode-btn px-4 py-2 rounded-lg border-2 border-gray-300 hover:bg-gray-100 transition" data-mode="study">Study Mode</button>
        </div>

        <!-- Question Display -->
        <div id="questionDisplay" class="text-center mb-4"></div>

        <!-- Hint -->
        <div id="hint" class="text-center text-sm my-4"></div>

        <!-- Audio Section -->
        <div id="audioSection" class="text-center my-4 hidden">
            <button id="playAudioBtn" class="bg-cyan-500 hover:bg-cyan-600 text-white px-6 py-3 rounded-lg transition">ğŸ”Š Play Sound</button>
        </div>

        <!-- Type Mode -->
        <div id="typeMode" class="space-y-4">
            <input type="text" id="answerInput" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-lg" placeholder="Type your answer...">
            <button id="checkBtn" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition">Check Answer</button>
        </div>

        <!-- Choice Mode -->
        <div id="choiceMode" class="hidden">
            <div id="options" class="grid grid-cols-2 gap-3"></div>
        </div>

        <!-- Fuzzy Mode -->
        <div id="fuzzyMode" class="hidden space-y-4">
            <input type="text" id="fuzzyInput" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-lg" placeholder="Type your answer...">
            <div id="fuzzyOptions" class="grid grid-cols-2 gap-3"></div>
        </div>

        <!-- Study Mode -->
        <div id="studyMode" class="hidden">
            <div class="text-center text-gray-600 mb-4">Study all dialogues</div>
            <div id="studyList" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
        </div>

        <!-- Feedback -->
        <div id="feedback" class="text-center text-2xl font-semibold my-4 min-h-[24px]"></div>

        <!-- Stats -->
        <div id="stats" class="flex justify-between text-sm text-gray-600 pt-4 border-t border-gray-200">
            <span>Score: <span id="score" class="font-semibold">0</span>/<span id="total" class="font-semibold">0</span></span>
            <span id="timerDisplay" style="display: none;"></span>
            <span>Accuracy: <span id="accuracy" class="font-semibold">0%</span></span>
        </div>

        <!-- Pattern Guide -->
        <div class="mt-8 bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg">
            <h3 class="font-bold mb-2">ğŸ“š Grammar Patterns Reference</h3>
            <div class="text-xs space-y-1 text-gray-700">
                <div><span class="font-semibold">1.</span> Aè·ŸBä¸€æ · / Aæ¯”B + adj - Comparison</div>
                <div><span class="font-semibold">2.</span> V1ç€V2 - Simultaneous actions</div>
                <div><span class="font-semibold">3.</span> æ—¶é—´+æ‰ - Late occurrence</div>
                <div><span class="font-semibold">4.</span> (Aä¸V), Bæ‰V - Contrastive emphasis</div>
                <div><span class="font-semibold">5.</span> åˆ°åº• - Emphatic questions</div>
                <div><span class="font-semibold">6.</span> çœ‹èµ·æ¥/çœ‹å‡ºæ¥ - Appearance vs perception</div>
                <div><span class="font-semibold">7.</span> QW+éƒ½ - Universal quantifier</div>
                <div><span class="font-semibold">8.</span> åªè¦...å°±... - Conditional</div>
            </div>
        </div>
    </div>

    <script>
        const dialogues = [
            // Pattern 1: Aè·ŸBä¸€æ ·
            {
                char: 'è·Ÿ',
                pinyin: 'gÄ“n',
                meaning: 'A: ä½ çš„æˆ¿é—´å¤§å—ï¼Ÿ B: ä¸å¤ªå¤§ã€‚æˆ‘çš„æˆ¿é—´___ä½ çš„ä¸€æ ·å¤§ã€‚'
            },

            // Pattern 2: V1ç€V2
            {
                char: 'åç€',
                pinyin: 'zuÃ²zhe',
                meaning: 'A: ä½ å–œæ¬¢æ€ä¹ˆå­¦ä¹ ï¼Ÿ B: æˆ‘å–œæ¬¢___å¬éŸ³ä¹ã€‚'
            },

            // Pattern 3: æ—¶é—´+æ‰
            {
                char: 'æ‰',
                pinyin: 'cÃ¡i',
                meaning: 'A: ä»–ä»€ä¹ˆæ—¶å€™åˆ°çš„ï¼Ÿ B: å¾ˆæ™šã€‚ä»–åä¸€ç‚¹___åˆ°ã€‚'
            },

            // Pattern 4: (Aä¸V), Bæ‰V
            {
                char: 'ä¸/æ‰',
                pinyin: 'bÃ¹/cÃ¡i',
                meaning: 'A: æˆ‘ä»¬å»çœ‹ç”µå½±å§ï¼ B: ä½ ___å»ï¼Œæˆ‘___ä¸å»å‘¢ã€‚'
            },

            // Pattern 5: åˆ°åº•
            {
                char: 'åˆ°åº•',
                pinyin: 'dÃ odÇ',
                meaning: 'A: ä½ æƒ³åƒä¸­å›½èœè¿˜æ˜¯ç¾å›½èœï¼Ÿ B: æˆ‘ä¸çŸ¥é“ã€‚ A: ä½ ___æƒ³åƒä»€ä¹ˆï¼Ÿ'
            },

            // Pattern 6: çœ‹èµ·æ¥
            {
                char: 'çœ‹èµ·æ¥',
                pinyin: 'kÃ n qÇlÃ¡i',
                meaning: 'A: ä½ è§‰å¾—è¿™ä¸ªèœæ€ä¹ˆæ ·ï¼Ÿ B: ___å¾ˆå¥½åƒã€‚'
            },

            // Pattern 6b: çœ‹å‡ºæ¥
            {
                char: 'çœ‹å‡ºæ¥',
                pinyin: 'kÃ n chÅ«lÃ¡i',
                meaning: 'A: å¥¹æ€ä¹ˆäº†ï¼Ÿ B: æˆ‘___å¥¹ä¸é«˜å…´ã€‚'
            },

            // Pattern 7: QW+éƒ½
            {
                char: 'ä»€ä¹ˆéƒ½',
                pinyin: 'shÃ©nme dÅu',
                meaning: 'A: ä½ å–œæ¬¢åƒä»€ä¹ˆèœï¼Ÿ B: æˆ‘___å–œæ¬¢åƒã€‚'
            },

            // Pattern 8: åªè¦...å°±...
            {
                char: 'åªè¦/å°±',
                pinyin: 'zhÇyÃ o/jiÃ¹',
                meaning: 'A: ä½ ä¼šæ¥å—ï¼Ÿ B: ___ä½ è¯·æˆ‘ï¼Œæˆ‘___æ¥ã€‚'
            },

            // Pattern 1b: Aæ¯”B
            {
                char: 'æ¯”',
                pinyin: 'bÇ',
                meaning: 'A: ä½ å“¥å“¥å’Œä½ å¼Ÿå¼Ÿè°é«˜ï¼Ÿ B: æˆ‘å“¥å“¥___æˆ‘å¼Ÿå¼Ÿé«˜ã€‚'
            },

            // Additional practice
            {
                char: 'ç«™ç€',
                pinyin: 'zhÃ nzhe',
                meaning: 'A: ä»–åœ¨åšä»€ä¹ˆï¼Ÿ B: ä»–___è¯´è¯ã€‚'
            },

            {
                char: 'æ‰',
                pinyin: 'cÃ¡i',
                meaning: 'A: å¥¹ä»€ä¹ˆæ—¶å€™åˆ°çš„ï¼Ÿ B: å¥¹ä¹ç‚¹___åˆ°ã€‚'
            },

            {
                char: 'è·Ÿ',
                pinyin: 'gÄ“n',
                meaning: 'A: ä½ çš„æœ‹å‹é«˜å—ï¼Ÿ B: æˆ‘çš„æœ‹å‹___æˆ‘ä¸€æ ·é«˜ã€‚'
            },

            {
                char: 'åˆ°åº•',
                pinyin: 'dÃ odÇ',
                meaning: 'A: ä½ è¦å»å“ªå„¿ï¼Ÿ B: æˆ‘è¿˜æ²¡æƒ³å¥½ã€‚ A: ä½ ___è¦å»å“ªå„¿ï¼Ÿ'
            },

            {
                char: 'è°éƒ½',
                pinyin: 'shÃ©i dÅu',
                meaning: 'A: æœ‰äººè®¤è¯†ä»–å—ï¼Ÿ B: ___è®¤è¯†ä»–ã€‚'
            },

            // Mixed pattern practice
            {
                char: 'çœ‹èµ·æ¥',
                pinyin: 'kÃ n qÇlÃ¡i',
                meaning: 'Context: Weekend plans. A: å‘¨æœ«æˆ‘ä»¬å»çˆ¬å±±å§ï¼ B: å¯æ˜¯ä½ ___å¾ˆç´¯ï¼Œæ²¡é—®é¢˜å—ï¼Ÿ'
            },

            {
                char: 'åªè¦/å°±',
                pinyin: 'zhÇyÃ o/jiÃ¹',
                meaning: 'Context: Weekend plans. A: ___ä½ æ¥ï¼Œæˆ‘___é«˜å…´ã€‚'
            },

            {
                char: 'æ‰',
                pinyin: 'cÃ¡i',
                meaning: 'Context: Weekend plans. B: å¥½å§ã€‚ä½†æ˜¯æˆ‘æ˜¨å¤©æ™šä¸ŠåäºŒç‚¹___ç¡è§‰ï¼Œæœ‰ç‚¹å„¿ç´¯ã€‚'
            },

            {
                char: 'åˆ°åº•',
                pinyin: 'dÃ odÇ',
                meaning: 'Context: Choosing restaurant. A: ä½ ___æƒ³å»å“ªä¸ªé¥­é¦†å„¿ï¼Ÿ'
            },

            {
                char: 'çœ‹èµ·æ¥',
                pinyin: 'kÃ n qÇlÃ¡i',
                meaning: 'Context: Choosing restaurant. A: é‚£ä¸ªæ–°å¼€çš„å·èœé¦†___å¾ˆå¥½åƒã€‚'
            }
        ];

        // Initialize the quiz with the dialogue data
        initQuiz(dialogues, {
            defaultMode: 'meaning-to-char',
            enablePreviewQueue: false
        });
    </script>
</body>
</html>
