<!DOCTYPE html>
<html lang="zh-CN" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>Dictation â€“ Lesson 7 (ç”·å¥³åŒä½)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/lesson-layout.css">
    <script src="js/utils.js"></script>
    <script src="js/command-palette.js"></script>
    <script src="js/etymology-loader.js"></script>
    <script src="js/pinyin-utils.js"></script>
    <script src="js/engine/ai-service.js"></script>
    <script src="js/engine/chat.js"></script>
    <script src="js/quiz-engine.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-sync.js"></script>
</head>
<body class="experimental-layout">
    <a href="home.html" class="home-btn">â† Home</a>

    <div class="app-container">
        <aside class="sidebar">
            <h2>Dictation Modes</h2>
            <p class="mode-desc">Hear a line, type the pinyin or meaning. Enter submits instantly; Space replays audio.</p>
            <nav>
                <button class="mode-btn" data-mode="audio-to-pinyin">Audio â†’ Pinyin</button>
                <button class="mode-btn" data-mode="char-to-pinyin">Text â†’ Pinyin</button>
                <button class="mode-btn" data-mode="audio-to-meaning">Audio â†’ Meaning</button>
                <button class="mode-btn" data-mode="audio-to-meaning-chunks">Audio â†’ Meaning (Chunks)</button>
                <button class="mode-btn" data-mode="text-to-meaning">Text â†’ Meaning</button>
                <button class="mode-btn" data-mode="text-to-meaning-chunks">Text â†’ Meaning (Chunks)</button>
                <button class="mode-btn" data-mode="dictation-chat">AI Chat</button>
                <button class="mode-btn" data-mode="study">Study Mode</button>
            </nav>
        </aside>

        <main class="main-content">
            <header class="quiz-header">
                <h1>Dictation: Lesson 7 ç”·å¥³åŒä½</h1>
            </header>

            <section class="quiz-display">
                <div id="questionDisplay"></div>

                <div id="upcomingCharacters" class="hidden" style="margin-top: 1rem;">
                    <div class="preview-list" style="display: flex; justify-content: center; gap: 1rem; font-size: 2rem; color: #d1d5db;"></div>
                    <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: #9ca3af; margin-top: 0.5rem;">Upcoming</div>
                </div>

                <div id="hint" style="font-size: 1.25rem; font-weight: 600; margin: 0.75rem 0;"></div>

                <div id="audioSection" class="hidden" style="margin: 1rem 0;">
                    <button id="playAudioBtn">ğŸ”Š Play Sentence</button>
                </div>
            </section>

            <section class="input-section">
                <div id="typeMode">
                    <input type="text" id="answerInput" placeholder="Type your answer...">
                    <button id="checkBtn" style="display: none;">Check Answer</button>
                </div>

                <div id="choiceMode">
                    <div id="options" class="choice-grid"></div>
                </div>

                <div id="fuzzyMode">
                    <input type="text" id="fuzzyInput" placeholder="Type your answer...">
                    <div id="fuzzyOptions" class="choice-grid" style="margin-top: 0.75rem;"></div>
                </div>

                <div id="studyMode">
                    <div style="text-align: center; color: #6b7280; margin-bottom: 1rem;">Click the speaker to replay any line. Use Study Mode to preview before dictation.</div>
                    <div id="studyList" style="max-height: 420px; overflow-y: auto;"></div>
                </div>

                <div id="feedback"></div>
            </section>

            <footer class="stats-bar" id="stats">
                <div>Score: <span id="score">0</span>/<span id="total">0</span></div>
                <div id="timerDisplay"></div>
                <div>Accuracy: <span id="accuracy">0%</span></div>
            </footer>
        </main>
    </div>

    <script>
        const dictationSentences = [
            { char: 'å¥³ï¼šå¦ˆï¼Œä»ä¸‹ä¸ªå­¦æœŸèµ·ï¼Œæˆ‘è¦å’Œå‡ ä¸ªåŒå­¦ä½åœ¨å­¦æ ¡é™„è¿‘çš„ä¸€ä¸ªå…¬å¯“é‡Œã€‚æˆ‘ä¸æƒ³å†ä½å®¿èˆäº†ã€‚', pinyin: 'nÇš: mÄ, cÃ³ng xiÃ .ge xuÃ©qÄ« qÇ, wÇ’ yÃ o hÃ© jÇ.ge tÃ³ngxuÃ© zhÃ¹ zÃ i xuÃ©xiÃ o fÃ¹jÃ¬n .de yÃ­.ge gÅngyÃ¹ lÇ. wÇ’ bÃ¹ xiÇng zÃ i zhÃ¹ sÃ¹shÃ¨ .le', meaning: 'Daughter: Mom, starting next semester Iâ€™m going to live with a few classmates in an apartment near school. I donâ€™t want to stay in the dorm anymore.' },
            { char: 'æ¯ï¼šä½å®¿èˆä¸æ˜¯å¾ˆæ–¹ä¾¿å—ï¼Œä¸ºä»€ä¹ˆè¦æ¬å‡ºå»å‘¢ï¼Ÿ', pinyin: 'mÇ”: zhÃ¹ sÃ¹shÃ¨ bÃº.shÃ¬ hÄ›n fÄngbiÃ n .ma, wÃ¨i.shÃ©n.me yÃ o bÄn chÅ«.qÃ¹ .ne', meaning: 'Mom: Isnâ€™t the dorm very convenient? Why move out?' },
            { char: 'å¥³ï¼šæ–¹ä¾¿æ˜¯æ–¹ä¾¿ï¼Œå¯æ˜¯åƒé¥­æ˜¯ä¸ªå¤§é—®é¢˜ã€‚å®¿èˆé‡Œæ²¡æœ‰å¨æˆ¿ï¼Œä¸€å®šå¾—åœ¨å­¦æ ¡é£Ÿå ‚åƒé¥­ï¼Œåˆè´µåˆä¸å¥½åƒï¼Œæ¯å¤©åƒçš„çœŸå—ä¸äº†ã€‚', pinyin: 'nÇš: fÄngbiÃ n shÃ¬ fÄngbiÃ n, kÄ›.shÃ¬ chÄ«fÃ n shÃ¬ yÃ­.ge dÃ  wÃ¨ntÃ­. sÃ¹shÃ¨ lÇ mÃ©i.yÇ’u chÃºfÃ¡ng, yÃ­dÃ¬ng dÄ›i zÃ i xuÃ©xiÃ o shÃ­tÃ¡ng chÄ«fÃ n, yÃ²u guÃ¬ yÃ²u bÃ¹ hÇochÄ«, mÄ›itiÄn chÄ« .de zhÄ“n shÃ²u.bu.liÇo', meaning: 'Daughter: Convenient, yes, but eating is a big problem. Thereâ€™s no kitchen in the dorm so we have to eat at the cafeteriaâ€”itâ€™s expensive and not tasty; eating it every day is unbearable.' },
            { char: 'æ¯ï¼šä½ çœŸæŒ‘å‰”ã€‚åŠŸè¯¾è¿™ä¹ˆå¿™ï¼Œä½ å“ªå„¿æœ‰æ—¶é—´ä¹°èœåšé¥­å•Šï¼Ÿ', pinyin: 'mÇ”: nÇ zhÄ“n tiÄo.ti. gÅngkÃ¨ zhÃ¨.me mÃ¡ng, nÇ nÇr yÇ’u shÃ­jiÄn mÇi cÃ i zuÃ² fÃ n a', meaning: 'Mom: Youâ€™re so picky. With classes this busy, when will you have time to buy groceries and cook?' },
            { char: 'å¥³ï¼šæˆ‘ä»¬äº”ä¸ªäººè½®æµï¼Œæ¯äººåªåšä¸€å¤©æ™šé¥­ï¼Œæ—©é¥­ã€ä¸­é¥­å°±åƒä¸‰æ˜æ²»ï¼Œç®€å•å¾—å¾ˆã€‚', pinyin: 'nÇš: wÇ’.men wÇ”.ge rÃ©n lÃºnliÃº, mÄ›i rÃ©n zhÇ zuÃ² yÃ¬ tiÄn wÇnfÃ n, zÇofÃ n, zhÅngfÃ n jiÃ¹ chÄ« sÄnmÃ­ngzhÃ¬, jiÇndÄn .de hÄ›n', meaning: 'Daughter: The five of us will take turns; each person only cooks dinner one day. For breakfast and lunch weâ€™ll just eat sandwichesâ€”super simple.' },
            { char: 'æ¯ï¼šè¯´èµ·æ¥å®¹æ˜“ï¼Œåšèµ·æ¥å¯å°±ä¸ç®€å•äº†ã€‚', pinyin: 'mÇ”: shuÅ.qi.lai rÃ³ngyÃ¬, zuÃ².qi.lai kÄ› jiÃ¹ bÃ¹ jiÇndÄn .le', meaning: 'Mom: Easy to say, not so easy to do.' },
            { char: 'å¥³ï¼šå¦ˆï¼Œæˆ‘ä»¬äº”ä¸ªäººå†³å®šæ¯äººå¸¦ä¸€æ ·å¨æˆ¿ç”¨å…·åˆ°å­¦æ ¡æ¥ï¼Œå®¶é‡Œæ˜¯ä¸æ˜¯æœ‰ä¸¤ä¸ªå¾®æ³¢ç‚‰å•Šï¼Œé‚£ä¸ªå°çš„è¿˜èƒ½ä¸èƒ½ç»™æˆ‘ï¼Ÿ', pinyin: 'nÇš: mÄ, wÇ’.men wÇ”.ge rÃ©n juÃ©dÃ¬ng mÄ›i rÃ©n dÃ i yÃ­yÃ ng chÃºfÃ¡ng yÃ²ngjÃ¹ dÃ o xuÃ©xiÃ o lÃ¡i, jiÄ lÇ shÃ¬.bu.shÃ¬ yÇ’u liÇng.ge wÄ“ibÅlÃº .a, nÃ .ge xiÇo .de hÃ¡i nÃ©ng.bu.nÃ©ng gÄ›i wÇ’', meaning: 'Daughter: Mom, we decided each person will bring one kitchen appliance to school. Donâ€™t we have two microwaves at home? Could you let me take the small one?' },
            { char: 'æ¯ï¼šå¯ä»¥ï¼Œå¯ä»¥ã€‚å¯æ˜¯é‚£ä¸ªå¾®æ³¢ç‚‰å¥½ä¹…æ²¡ç”¨äº†ï¼Œä¸çŸ¥é“åäº†æ²¡æœ‰ã€‚é‚£ä¸ªå…¬å¯“é‡Œæœ‰æ²¡æœ‰åœ°æ¯¯å•Šï¼Ÿ', pinyin: 'mÇ”: kÄ›.yÇ, kÄ›.yÇ. kÄ›.shÃ¬ nÃ .ge wÄ“ibÅlÃº hÇo jiÇ” mÃ©i yÃ²ng .le, bÃ¹ zhÄ«dao huÃ i .le mÃ©i.yÇ’u. nÃ .ge gÅngyÃ¹ lÇ yÇ’u mÃ©i.yÇ’u dÃ¬tÇn .a', meaning: 'Mom: Sure, sure. But that microwave hasnâ€™t been used in agesâ€”Iâ€™m not sure if it still works. Does that apartment have any carpets?' },
            { char: 'å¥³ï¼šæˆ‘çš„å±‹å­é‡Œæœ‰ä¸€å¼ åºŠï¼Œä¸€å¼ æ¡Œå­ï¼Œä¸€ä¸ªä¹¦æ¶ï¼Œä¸¤æŠŠæ¤…å­ï¼Œè¿˜æœ‰ä¸€ä¸ªå°ç¯ï¼Œå°±æ˜¯æ²¡æœ‰åœ°æ¯¯ã€‚', pinyin: 'nÇš: wÇ’.de wÅ«.zi lÇ yÇ’u yÃ¬ zhÄng chuÃ¡ng, yÃ¬ zhÄng zhuÅ.zi, yÃ­.ge shÅ«jiÃ , liÇng bÇ yÇ.zi, hÃ¡i yÇ’u yÃ­.ge tÃ¡idÄ“ng, jiÃ¹.shÃ¬ mÃ©i.yÇ’u dÃ¬tÇn', meaning: 'Daughter: My room has a bed, a desk, a bookshelf, two chairs, and a desk lampâ€”just no carpet.' },
            { char: 'æ¯ï¼šæ²¡æœ‰åœ°æ¯¯å€’ä¸è¦ç´§ï¼Œå“¦ï¼Œå¯¹äº†ï¼Œè·Ÿä½ åˆä½çš„é‚£å››ä¸ªäººéƒ½æ˜¯è°å•Šï¼Ÿæˆ‘éƒ½è®¤è¯†å—ï¼Ÿ', pinyin: 'mÇ”: mÃ©i.yÇ’u dÃ¬tÇn dÃ o bÃº yÃ ojÇn, Ã³, duÃ¬.le, gÄ“n nÇ hÃ©zhÃ¹ .de nÃ  sÃ¬.ge rÃ©n dÅu shÃ¬ shÃ©i .a? wÇ’ dÅu rÃ¨nshi .ma', meaning: 'Mom: No carpet isnâ€™t a big deal. Oh rightâ€”who are the four people living with you? Do I know them?' },
            { char: 'å¥³ï¼šä¸€ä¸ªæ˜¯Susanï¼Œä¸€ä¸ªæ˜¯Maryï¼Œè¿˜æœ‰Davidè·Ÿâ€¦', pinyin: 'nÇš: yÃ­.ge shÃ¬ Susan, yÃ­.ge shÃ¬ Mary, hÃ¡i.yÇ’u David gÄ“nâ€¦', meaning: 'Daughter: One is Susan, one is Mary, and David andâ€¦' },
            { char: 'æ¯ï¼šä»€ä¹ˆï¼æœ‰ä¸€ä¸ªæ˜¯ç”·çš„ï¼Ÿ', pinyin: 'mÇ”: shÃ©n.me! yÇ’u yÃ­.ge shÃ¬ nÃ¡n.de', meaning: 'Mom: What! One of them is a man?' },
            { char: 'å¥³ï¼šæ˜¯å•Šï¼ŒDavidä¹Ÿæ˜¯äºŒå¹´çº§çš„å­¦ç”Ÿï¼Œæˆ‘ä»¬å¸¸åœ¨ä¸€èµ·çš„ï¼Œä»–äººå¾ˆå¥½ã€‚', pinyin: 'nÇš: shÃ¬ .a, David yÄ›.shÃ¬ Ã¨r niÃ¡njÃ­ .de xuÃ©.shÄ“ng, wÇ’.men chÃ¡ng zÃ i yÃ¬qÇ .de, tÄ rÃ©n hÄ›n hÇo', meaning: 'Daughter: Yup, Davidâ€™s also a second-year studentâ€”weâ€™re often together; heâ€™s very nice.' },
            { char: 'æ¯ï¼šç”·çš„å¥³çš„ä½åœ¨ä¸€ä¸ªå…¬å¯“é‡Œä¸å¤ªå¥½å§ã€‚é‚£ä¸ªå…¬å¯“é‡Œæœ‰å‡ ä¸ªæµ´å®¤å•æ‰€å•Šï¼Ÿ', pinyin: 'mÇ”: nÃ¡n.de nÇš.de zhÃ¹ zÃ i yÃ­.ge gÅngyÃ¹ lÇ bÃ¹ tÃ i hÇo .ba. nÃ .ge gÅngyÃ¹ lÇ yÇ’u jÇ.ge yÃ¹shÃ¬ cÃ¨suÇ’ .a', meaning: 'Mom: Men and women living in one apartment doesnâ€™t seem great. How many bathrooms are there?' },
            { char: 'å¥³ï¼šåªæœ‰ä¸€ä¸ªã€‚', pinyin: 'nÇš: zhÇ yÇ’u yÃ­.ge', meaning: 'Daughter: Only one.' },
            { char: 'æ¯ï¼šæ€ä¹ˆç”·çš„å¥³çš„åˆç”¨ä¸€ä¸ªå•æ‰€å•Šï¼Ÿæˆ‘æƒ³ä½ æœ€å¥½å†è€ƒè™‘è€ƒè™‘è¦ä¸è¦è·Ÿä»–ä»¬ä½åœ¨ä¸€èµ·ã€‚', pinyin: 'mÇ”: zÄ›n.me nÃ¡n.de nÇš.de hÃ©yÃ²ng yÃ­.ge cÃ¨suÇ’ .a? wÇ’ xiÇng nÇ zuÃ¬hÇo zÃ i kÇolÇœ kÇolÇœ yÃ o bÃ¹ yÃ o gÄ“n tÄ.men zhÃ¹ zÃ i yÃ¬qÇ', meaning: 'Mom: How can men and women share one bathroom? I think youâ€™d better reconsider living with them.' },
            { char: 'å¥³ï¼šè¿™æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå­¦æ ¡çš„å®¿èˆä¹Ÿæ˜¯ç”·å¥³åŒä½ä¸€å±‚æ¥¼çš„ï¼Œä¹Ÿæœ‰åˆç”¨å•æ‰€çš„ã€‚å¦ˆï¼Œæ˜å¤©è¿˜æœ‰è€ƒè¯•å‘¢ï¼Œä¸è·Ÿæ‚¨å¤šè¯´äº†ã€‚', pinyin: 'nÇš: zhÃ¨ yÇ’u shÃ©n.me guÄn.xÃ¬ .ne? xuÃ©xiÃ o .de sÃ¹shÃ¨ yÄ›.shÃ¬ nÃ¡n.nÇš tÃ³ng zhÃ¹ yÃ¬ cÃ©ng lÃ³u .de, yÄ› yÇ’u hÃ©yÃ²ng cÃ¨suÇ’ .de. mÄ, mÃ­ngtiÄn hÃ¡i yÇ’u kÇoshÃ¬ .ne, bÃ¹ gÄ“n nÃ­n duÅ shuÅ .le', meaning: 'Daughter: Whatâ€™s the big deal? The school dorms also have men and women on the same floor and shared bathrooms. Mom, I still have a test tomorrow, so Iâ€™ll stop here.' },
            { char: 'æ¯ï¼šå¥½å§ï¼Œå¥½å§ã€‚', pinyin: 'mÇ”: hÇo.ba, hÇo.ba', meaning: 'Mom: Fine, fine.' }
        ];

        const paletteItems = [
            { name: 'Dictation: Audio â†’ Pinyin', mode: 'audio-to-pinyin', type: 'mode' },
            { name: 'Dictation: Text â†’ Pinyin', mode: 'char-to-pinyin', type: 'mode' },
            { name: 'Dictation: Audio â†’ Meaning', mode: 'audio-to-meaning', type: 'mode' },
            { name: 'Dictation: Audio â†’ Meaning (Chunks)', mode: 'audio-to-meaning-chunks', type: 'mode' },
            { name: 'Dictation: Text â†’ Meaning', mode: 'text-to-meaning', type: 'mode' },
            { name: 'Dictation: Text â†’ Meaning (Chunks)', mode: 'text-to-meaning-chunks', type: 'mode' },
            { name: 'Dictation: AI Chat', mode: 'dictation-chat', type: 'mode' },
            { name: 'Dictation: Study Mode', mode: 'study', type: 'mode' }
        ];

        initQuiz(dictationSentences, {
            defaultMode: 'audio-to-meaning',
            commandPaletteItems: paletteItems
        });
    </script>
</body>
</html>
